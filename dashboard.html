<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Dashboard - Wealthwise</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- ========== TAILWIND & GOOGLE FONTS SECTION ========== -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet">
  <!-- Tailwind config must be set BEFORE loading the CDN script! -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <script>
    window.tailwind = window.tailwind || {};
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'ww-dark-bg': '#1a2332',
            'ww-dark-card': '#232c3f',
            'ww-dark-text': '#e5e9f2',
            'ww-dark-accent': '#f3c96b',
            'ww-light-bg': '#f4f6fa',
            'ww-light-card': '#fff',
            'ww-light-text': '#22304a',
            'ww-light-secondary': '#51607a',
            'ww-light-accent': '#3157a1',
            'ww-light-accent-contrast': '#e2e9f3',
            'ww-accent-blue': '#2563eb',
            'ww-accent-blue-dark': '#1d4ed8',
            'ww-field-light': '#f9fafb',
            'ww-field-lighter': '#f3f4f6',
            'ww-light-yellow': '#FFD600',
            'ww-light-yellow-hover': '#FFC300',
          }
        }
      }
    }
  </script>
  <!-- ========== CSS SECTION ========== -->
  <style>
    html, body {
      background: #f4f6fa;
      color: #22304a;
      font-family: 'Montserrat', Arial, sans-serif !important;
      transition: background 0.2s, color 0.2s;
      min-height: 100vh;
    }
    .dark body, body.dark {
      background: #1a2332 !important;
      color: #e5e9f2 !important;
    }
    .avatar-img-btn {
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      display: flex;
      align-items: center;
      cursor: pointer;
      border-radius: 50%;
      position: relative;
      outline: none;
    }
    .avatar-img {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      border: 2px solid #2563eb;
      object-fit: cover;
      background: #fff;
      display: inline-block;
      vertical-align: middle;
    }
    .ww-user-dropdown {
      display: none;
      position: absolute;
      right: 0;
      top: 110%;
      background: #fff;
      color: #1a2332;
      border: 1px solid #e2e9f3;
      border-radius: 0.7em;
      min-width: 220px;
      width: max-content;
      box-shadow: 0 8px 24px 0 rgba(49, 87, 161, 0.15);
      text-align: left;
      font-family: 'Montserrat', Arial, sans-serif;
      white-space: nowrap;
      z-index: 10000;
    }
    .dark .ww-user-dropdown {
      background: #232c3f !important;
      color: #e5e9f2 !important;
      border-color: #232c3f;
    }
    .ww-user-dropdown__profile {
      display: flex;
      align-items: center;
      padding: 1em 1.2em 0.8em 1.2em;
      border-bottom: 1px solid #e2e9f3;
      gap: 0.7em;
    }
    .ww-user-dropdown__profile-avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #2563eb;
    }
    .dark .ww-user-dropdown__profile-avatar {
      border-color: #FFD600;
    }
    .ww-user-dropdown__profile-info {
      display: flex;
      flex-direction: column;
    }
    .ww-user-dropdown__profile-name {
      font-weight: 700;
      font-size: 1.14em;
      color: #2563eb;
      line-height: 1.1;
    }
    .dark .ww-user-dropdown__profile-name {
      color: #FFD600;
    }
    .ww-user-dropdown__profile-email {
      font-size: 0.97em;
      color: #51607a;
    }
    .dark .ww-user-dropdown__profile-email {
      color: #f3c96b;
    }
    .ww-user-dropdown button {
      width: 100%;
      text-align: left;
      padding: 0.85em 1.5em;
      background: none;
      border: none;
      font-weight: 600;
      font-size: 1em;
      cursor: pointer;
      color: #b91c1c;
      border-radius: 0 0 0.7em 0.7em;
      transition: background 0.15s, color 0.15s;
    }
    .dark .ww-user-dropdown button {
      color: #f87171;
    }
    .ww-user-dropdown button:hover {
      background: #f3f4f6;
      color: #b91c1c;
    }
    .dark .ww-user-dropdown button:hover {
      background: #1a2332 !important;
      color: #FFD600 !important;
    }
    .footer-links a {
      margin: 0 0.6em;
      color: #FFD600;
      font-weight: bold;
      text-decoration: none;
      transition: color 0.18s;
    }
    .footer-links a:hover {
      color: #FFC300;
    }
    .dark .footer-links a {
      color: #FFD600;
    }
    .dark .footer-links a:hover {
      color: #FFC300;
    }
    /* Hide avatar on mobile/ipad, show hamburger */
    @media (max-width: 1024px) {
      #avatar-dropdown-btn {
        display: none !important;
      }
      #hamburger-btn {
        display: inline-flex !important;
      }
    }
    @media (min-width: 1025px) {
      #avatar-dropdown-btn {
        display: inline-flex !important;
      }
      #hamburger-btn {
        display: none !important;
      }
    }
  </style>
  <script>
    // ========== DARK MODE INITIALIZER SECTION ==========
    (function() {
      let theme = localStorage.getItem('wealthwise-theme');
      if (!theme) {
        theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    })();
  </script>
</head>
<body class="min-h-screen flex flex-col text-ww-light-text dark:text-ww-dark-text transition-colors duration-200">

  <!-- ========== HEADER SECTION ========== -->
  <header class="bg-ww-dark-bg text-ww-dark-accent py-4 px-2 flex items-center w-full shadow-md flex-shrink-0 border-b border-ww-light-accent-contrast transition-colors duration-200" id="ww-header-bar">
    <a href="index.html" class="font-bold text-xl md:text-2xl tracking-wide logo-title block text-ww-light-yellow dark:text-ww-dark-accent ml-2" style="font-family:'Montserrat',Arial,sans-serif; text-decoration: none;">
      Wealthwise
    </a>
    <div class="ml-auto flex items-center gap-2" id="header-right">
      <!-- Theme Toggle -->
      <button id="theme-toggle" type="button" class="p-2 rounded-lg focus:outline-none transition hover:bg-ww-light-accent-contrast dark:hover:bg-ww-dark-card" title="Toggle dark/light mode">
        <svg class="w-6 h-6 text-ww-light-yellow dark:hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5" stroke="currentColor" fill="none"/>
          <path stroke-linecap="round" d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M16.36 16.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M16.36 7.64l1.42-1.42"/>
        </svg>
        <svg class="w-6 h-6 text-ww-dark-accent hidden dark:inline" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 1111.21 3c.47 0 .94.03 1.41.08a7 7 0 008.3 9.71c.05.47.08.94.08 1.41z"/>
        </svg>
      </button>
      <!-- Avatar and Dropdown (desktop) -->
      <div style="position:relative;display:inline-block;">
        <button id="avatar-dropdown-btn" class="avatar-img-btn" tabindex="0" aria-haspopup="true" aria-expanded="false" style="padding:0;background:none;border:none;">
          <img id="user-avatar" class="avatar-img" src="" alt="User Avatar" style="display:none;" />
        </button>
        <button id="hamburger-btn" class="p-2 rounded-lg focus:outline-none transition bg-transparent" style="display:none;" aria-label="Menu">
          <!-- Hamburger Icon -->
          <svg class="w-8 h-8 text-ww-light-yellow dark:text-ww-dark-accent" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
            <line x1="4" y1="7" x2="20" y2="7" stroke-linecap="round"/>
            <line x1="4" y1="12" x2="20" y2="12" stroke-linecap="round"/>
            <line x1="4" y1="17" x2="20" y2="17" stroke-linecap="round"/>
          </svg>
        </button>
        <div class="ww-user-dropdown" id="avatar-dropdown-menu">
          <div class="ww-user-dropdown__profile" id="ww-dropdown-profile">
            <img class="ww-user-dropdown__profile-avatar" id="dropdown-profile-avatar" src="" alt="User Avatar" />
            <div class="ww-user-dropdown__profile-info">
              <span class="ww-user-dropdown__profile-name" id="dropdown-profile-name"></span>
              <span class="ww-user-dropdown__profile-email" id="dropdown-profile-email"></span>
            </div>
          </div>
          <button id="logout-btn" type="button" class="logout-btn">Logout</button>
        </div>
      </div>
    </div>
  </header>

  <!-- ========== MAIN SECTION ========== -->
  <main class="flex-1 flex flex-col items-center w-full px-2 transition-colors duration-200">
    <!-- Body intentionally left blank as requested -->
  </main>

  <!-- ========== FOOTER SECTION ========== -->
  <footer class="text-center text-ww-dark-text bg-ww-dark-bg border-t border-ww-light-accent-contrast py-3 mt-auto w-full text-sm transition-colors duration-200">
    <div class="mb-1 footer-links">
      <a href="/terms-of-service.html?return=" id="footer-terms-link" class="mx-2 text-ww-light-yellow dark:text-ww-dark-accent font-bold hover:text-ww-light-yellow-hover dark:hover:text-ww-dark-accent transition-colors">Terms of Service</a>
      <a href="/privacy-policy/" class="mx-2 text-ww-light-yellow dark:text-ww-dark-accent font-bold hover:text-ww-light-yellow-hover dark:hover:text-ww-dark-accent transition-colors">Privacy Policy</a>
    </div>
    <div>&copy; 2025 Wealthwise. All rights reserved.</div>
  </footer>
  <!-- ========== HEADER/FOOTER/AVATAR SCRIPT ========== -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const supabase = createClient(
      'https://anwwjqupywbnwanuckdf.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFud3dqcXVweXdibndhbnVja2RmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk0MzgxOTksImV4cCI6MjA2NTAxNDE5OX0.ExlSkJTP3mJ9u-7SVws0FYcNvlL9a4MJNsm8ZaK1X48'
    );

    // ========== THEME TOGGLE LOGIC ==========
    document.getElementById('theme-toggle').addEventListener('click', function() {
      const html = document.documentElement;
      const isDark = html.classList.contains('dark');
      if (isDark) {
        html.classList.remove('dark');
        localStorage.setItem('wealthwise-theme', 'light');
      } else {
        html.classList.add('dark');
        localStorage.setItem('wealthwise-theme', 'dark');
      }
    });

    // ========== SUPABASE PROFILE DROPDOWN LOGIC ==========
    async function loadUserProfileDropdown() {
      const { data: { user }, error } = await supabase.auth.getUser();
      const avatarImg = document.getElementById('user-avatar');
      const avatarDropdownBtn = document.getElementById('avatar-dropdown-btn');
      const avatarDropdownMenu = document.getElementById('avatar-dropdown-menu');
      const dropdownProfileAvatar = document.getElementById('dropdown-profile-avatar');
      const dropdownProfileName = document.getElementById('dropdown-profile-name');
      const dropdownProfileEmail = document.getElementById('dropdown-profile-email');
      const logoutBtn = document.getElementById('logout-btn');

      // Hide everything if not logged in
      if (error || !user) {
        if (avatarImg) avatarImg.style.display = "none";
        if (avatarDropdownBtn) avatarDropdownBtn.style.display = "none";
        if (avatarDropdownMenu) avatarDropdownMenu.style.display = "none";
        document.getElementById('hamburger-btn').style.display = "none";
        return;
      }

      // Fetch profile for display name and avatar
      const { data: profile, error: profileError } = await supabase
        .from('profiles')
        .select('display_name, avatar_url')
        .eq('id', user.id)
        .single();

      let displayName = 'User';
      let avatarUrl = '';
      if (!profileError && profile) {
        displayName = profile.display_name || 'User';
        avatarUrl = profile.avatar_url || '';
        if (avatarImg && avatarUrl) avatarImg.src = avatarUrl;
        if (dropdownProfileAvatar && avatarUrl) dropdownProfileAvatar.src = avatarUrl;
        if (dropdownProfileName) dropdownProfileName.textContent = displayName;
        if (dropdownProfileEmail) dropdownProfileEmail.textContent = user.email || '';
      } else {
        if (avatarImg) avatarImg.src = "";
        if (dropdownProfileAvatar) dropdownProfileAvatar.src = "";
        if (dropdownProfileName) dropdownProfileName.textContent = "User";
        if (dropdownProfileEmail) dropdownProfileEmail.textContent = user.email || '';
      }

      // Show avatar button for desktop, hamburger for mobile/ipad
      if (avatarImg) avatarImg.style.display = "inline-block";
      if (avatarDropdownBtn) avatarDropdownBtn.style.display = "";
      const hamburgerBtn = document.getElementById('hamburger-btn');
      if (hamburgerBtn) hamburgerBtn.style.display = "";

      // Dropdown logic
      if (avatarDropdownBtn && avatarDropdownMenu) {
        let isOpen = false;
        const showDropdown = () => {
          avatarDropdownMenu.style.display = "block";
          avatarDropdownBtn.setAttribute("aria-expanded", "true");
          isOpen = true;
        };
        const hideDropdown = () => {
          avatarDropdownMenu.style.display = "none";
          avatarDropdownBtn.setAttribute("aria-expanded", "false");
          isOpen = false;
        };
        avatarDropdownBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          isOpen ? hideDropdown() : showDropdown();
        });
        avatarDropdownBtn.addEventListener('blur', () => {
          setTimeout(hideDropdown, 120);
        });
        avatarDropdownBtn.addEventListener('keydown', (e) => {
          if (e.key === "Escape") hideDropdown();
        });
        document.addEventListener('click', (e) => {
          if (isOpen && !avatarDropdownBtn.contains(e.target)) {
            hideDropdown();
          }
        });

        // Hamburger opens dropdown as well
        const hamburgerBtn = document.getElementById('hamburger-btn');
        if (hamburgerBtn) {
          hamburgerBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            if (avatarDropdownMenu.style.display === "block") {
              avatarDropdownMenu.style.display = "none";
            } else {
              avatarDropdownMenu.style.display = "block";
              // For accessibility, focus the first dropdown item
              const firstLink = avatarDropdownMenu.querySelector('button, a, input, [tabindex]:not([tabindex="-1"])');
              if (firstLink) firstLink.focus();
            }
          });
          document.addEventListener('click', (e) => {
            if (!avatarDropdownMenu.contains(e.target) && !hamburgerBtn.contains(e.target)) {
              avatarDropdownMenu.style.display = "none";
            }
          });
        }
      }

      // Wire logout
      if (logoutBtn) {
        logoutBtn.onclick = async () => {
          await supabase.auth.signOut();
          window.location.href = "/logout.html";
        };
      }
    }

    // ========== INIT ON LOAD ==========
    document.addEventListener('DOMContentLoaded', () => {
      loadUserProfileDropdown();
    });
  </script>
</body>
</html>
